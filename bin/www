#!/usr/bin/env node

const https = require('https');
const fs = require('fs');

/*
 *postgresql pooling
 */
const { Pool } = require('pg');

const pool = new Pool({
  user: 'ahacad',
  password: 'root',
  host: 'localhost',
  database: 'api',
  port: 5432,
});
module.exports = pool;

/*
 *start server
 */
const port = 4000;
const options = {
  key: fs.readFileSync(`${__dirname}/localhost-key.pem`),
  cert: fs.readFileSync(`${__dirname}/localhost.pem`),
};
const app = require('../app');

const server = https.createServer(options, app);
server.listen(port, () => {
  console.log(`server running on port ${port}`);
});

/*
 *shutdown functions
 */
function shutDown() {
  console.log('Received kill signal, shutting down gracefully');
  server.close(() => {
    pool.end();
  });
}

process.on('SIGTERM', shutDown);
process.on('SIGINT', shutDown);
